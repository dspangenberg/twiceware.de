---
import PageLayout from '@/layouts/PageLayout.astro'
import ProjectCard from '@/components/ProjectCard.tsx'
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'
import type { Page } from 'astro'
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
} from '@/components/ui/pagination'
type Props = {
  projects: CollectionEntry<'projekte'>[]
  page: Page<CollectionEntry<'projekte'>>
  title?: string
}

const {
  projects,
  page,
  title
} = Astro.props

const allProjects = (await getCollection('projekte'))
  .filter(project => !project.data.draft)

const categories = [...new Set(allProjects.flatMap(project => project.data.category || []))]
const tags = [...new Set(allProjects.flatMap(project => project.data.tags || []))]
---
<PageLayout title="Referenzen" description="Referenzen" hideHeader>
  <div class="flex gap-6 flex-wrap xl:flex-nowrap">
    <div class="flex-none w-64" transition:persist="sidebar">
      <div class="sticky top-56 space-y-6">
        <ul>
          <li>
            <a href="/projekte/1">Alle Referenzen</a>
          </li>
        </ul>

        <div class="text-sm font-semibold uppercase mb-2 text-black">Kategorien</div>
        <ul class="flex flex-wrap sm:flex-col">
          {categories.map((category) => (
            <li>
              <a href={`/projekte/kategorie/${category}/1`}>
                {category}
              </a>
            </li>
          ))}
        </ul>
        <div class="text-sm font-semibold uppercase mb-2 text-black">Tags</div>
        <ul class="flex flex-wrap sm:flex-col">
          {tags.map((tag) => (
            <li>
              <a href={`/projekte/tag/${tag}/1`}>
                {tag}
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>
    <div class="flex-1 animate mb-12">
      <div class="flex flex-col">
        <h1 class="text-4xl font-bold mb-12">Referenzen {title}</h1>
        <ul class="flex flex-col gap-y-12">
          {projects.map((project) => (
            <li>
              <ProjectCard entry={project} />
            </li>
          ))}
        </ul>

        {page.total > 5 && <Pagination className="mt-12">
          <PaginationContent>
            {Array.from({ length: page.lastPage }, (_, i) => i + 1).map((pageNum) => (
              <PaginationItem>
                <PaginationLink href={`/projekte/${pageNum}`} isActive={pageNum === page.currentPage} size="default">
                  {pageNum}
                </PaginationLink>
              </PaginationItem>
            ))}
          </PaginationContent>
        </Pagination>
        }
      </div>
    </div>
  </div>
</PageLayout>

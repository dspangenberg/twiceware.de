---
import type { GetStaticPaths, Page } from 'astro'
import type { CollectionEntry } from 'astro:content'
import ProjectsLayout from '@/layouts/ProjectsLayout.astro'
import { getProjectsByTag, getTagsForProjects } from '@/lib/data.ts'

export const getStaticPaths = (async ({ paginate }) => {
  // Get all unique categories
  const tags = await getTagsForProjects()

  // Create paginated routes for each category
  const paths = await Promise.all(
    tags.map(async tag => {
      const filteredProjects = await getProjectsByTag(tag)
      return paginate(filteredProjects, {
        params: { tag },
        pageSize: 5
      })
    })
  )

  return paths.flat()
}) satisfies GetStaticPaths

type Props = {
  page: Page<CollectionEntry<'projekte'>>
}

const { page } = Astro.props
const projects = page.data
const title = `mit dem Tag ${Astro.params.tag}`
---

<ProjectsLayout projects={projects} page={page} title={title} />

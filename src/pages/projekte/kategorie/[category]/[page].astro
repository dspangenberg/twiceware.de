---
import type { GetStaticPaths, Page } from 'astro'
import type { CollectionEntry } from 'astro:content'
import ProjectsLayout from '@/layouts/ProjectsLayout.astro'
import { getCategoriesForProjects, getProjectsByCategory } from '@/lib/data.ts'

export const getStaticPaths = (async ({ paginate }) => {
  // Get all unique categories
  const categories = await getCategoriesForProjects()

  // Create paginated routes for each category
  const paths = await Promise.all(
    categories.map(async category => {
      const filteredProjects = await getProjectsByCategory(category)
      return paginate(filteredProjects, {
        params: { category },
        pageSize: 5
      })
    })
  )

  return paths.flat()
}) satisfies GetStaticPaths

type Props = {
  page: Page<CollectionEntry<'projekte'>>
}

const { page } = Astro.props
const projects = page.data
const title = `in der Kategorie ${Astro.params.category}`
---

<ProjectsLayout projects={projects} page={page} title={title} />
